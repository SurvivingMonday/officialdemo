"use strict";var app=angular.module("honeypotApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/tutorial",{templateUrl:"../views/tutorial.html",controller:"TutorialCtrl"}).when("/game",{templateUrl:"../views/game.html",controller:"GameCtrl"}).when("/test",{templateUrl:"../views/test.html",controller:"GameCtrl"}).otherwise({redirectTo:"/"})}]);app.service("GameManager",["$interval","GameMapService",function(a,b){var c={cash:210,attentionLevel:0,ecData:0,ecDataTemp:0,dataA:0,dataB:0,dataC:0,points:0,gameover:!1,inventory:[],marker:[]},d=0,e={};e.sellprice={ecData:4,dataA:8,dataB:15,dataC:25},e.onsale=[{name:"TT130",type:0,quality:1,price:100,risk:.2,hitfactor:.75,expiryTime:6,installationCost:10},{name:"XH-5",type:0,quality:2,price:150,risk:.1,hitfactor:.75,expiryTime:6,installationCost:12},{name:"TT230",type:0,quality:3,price:200,risk:.4,hitfactor:1.2,expiryTime:18,installationCost:16},{name:"XH-7",type:0,quality:4,price:350,risk:.4,hitfactor:1.4,expiryTime:18,installationCost:19},{name:"TT330",type:0,quality:5,price:400,risk:.6,hitfactor:2.2,expiryTime:30,installationCost:25}],this.updatetime=function(){d=setInterval(1e3)},this.initGame=function(){c.cash=210,c.attentionLevel=0,c.ecData=0,c.ecDataTemp=0,c.dataA=0,c.dataB=0,c.dataC=0,c.points=0,c.gameover=!1,c.inventory=[],c.marker=[]},this.getPlayer=function(){return c},this.getBlackM=function(){return e};var f=angular.noop;this.onAlert=function(a){f=a};var g=angular.noop;this.onGameOver=function(a){g=a},this.buy=function(a){if(c.cash>=e.onsale[a].price){c.cash-=e.onsale[a].price;for(var b=0;b<c.inventory.length;b++)if(c.inventory[b].name===e.onsale[a].name)return void f("You already have this item!");c.inventory.push(e.onsale[a])}else f("You do not have enough money!")},this.sell=function(){c.cash+=e.sellprice.ecData*c.ecData+e.sellprice.dataA*c.dataA+e.sellprice.dataB*c.dataB+e.sellprice.dataC*c.dataC,c.ecData=0,c.ecDataTemp=0,c.dataA=0,c.dataB=0,c.dataC=0},this.infect=function(a,b,d){a.countdown=Math.round(Math.random()+1),a.duration=c.inventory[b].expiryTime+Math.floor(30*Math.random()+1),a.timer=0,a.gps=c.inventory[b].hitfactor,console.log(d),d>0?(a.public=!0,c.points=100*d):a.public=!1,c.marker.push(a),c.cash-=c.inventory[b].installationCost,c.attentionLevel+=40*c.inventory[b].risk,c.points+=100*d},this.analysis=function(){c.dataA+=Math.round(.6*c.ecData),c.dataB+=Math.round(.3*c.ecData),c.dataC+=Math.round(.1*c.ecData),c.ecData=0,c.ecDataTemp=0},this.update=function(){for(var a=0;a<c.marker.length;a++)c.marker[a].duration-=1,c.marker[a].countdown>=0?(c.marker[a].countdown-=1,c.marker[a].timer=c.marker[a].duration):-1===c.marker[a].countdown&&(b.animateMarker(c.marker[a]),c.marker[a].timer-=1,c.marker[a].public===!0&&(c.ecDataTemp+=c.marker[a].gps,c.ecData=Math.floor(c.ecDataTemp))),5===c.marker[a].duration&&b.brokenKeyLogger(c.marker[a]),c.marker[a].duration<0&&(c.marker[a].setMap(null),c.marker.splice(a,1))},a(this.update,1e3)}]),app.factory("$",function(){return $}),app.factory("PlacesApi",function(){return google.maps.places}),app.factory("MapsApi",function(){return google.maps.Map}),app.factory("maps",function(){return google.maps}),app.factory("GameMapService",["PlacesApi","MapsApi","$","maps",function(a,b,c,d){var e,f=new d.LatLng(42.2814,-83.7483),g=function(){var a=[{featureType:"all",stylers:[{saturation:-100}]},{featureType:"road.arterial",elementType:"labels",stylers:[{hue:"#00ffee"},{saturation:-50}]},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"simplified"}]}],c=new google.maps.StyledMapType(a,{name:"Styled Map",minZoom:3,maxZoom:16}),d={zoom:15,center:f};e=new b(document.getElementById("map-canvas"),d),e.mapTypes.set("map_style",c),e.setMapTypeId("map_style")},h=function(a){d.event.addListener(e,"click",a)},i=function(b,c,f){f=f||angular.noop;var g={url:"/images/computers.png",size:new google.maps.Size(32,35),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,40)},h=new google.maps.Marker({position:b,map:e,icon:g});d.event.addListener(h,"click",f);var i=new a.PlacesService(e),j={location:b,radius:"100",types:["store","school","cafe","food","night_club","post_office","restaurant","school","hospital","library","lodging"]};i.nearbySearch(j,function(a){console.log(a),c(a.length,h)})},j=function(a){a.setAnimation(google.maps.Animation.BOUNCE)},k=function(a){var b={url:"/images/ant-export.png",size:new google.maps.Size(32,35),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,40)};a.setIcon(b)};return{init:g,addClickListeners:h,putKeylogger:i,animateMarker:j,brokenKeyLogger:k}}]),angular.module("honeypotApp").controller("MainCtrl",function(){}),app.controller("GameCtrl",["$scope","$timeout","GameManager","GameMapService",function(a,b,c,d){d.init();var e=null,f=function(c){a.notifyMessage=c,a.showMessage=!0,b(function(){a.showMessage=!1,a.notifyMessage=""},3e3)};c.onAlert(f),a.player=c.getPlayer(),a.blackMarket=c.getBlackM(),a.notifyBuy=c.buy,a.notifySell=c.sell,a.notifyAnalyze=c.analysis,a.selectInv=function(b){null!==e&&(a.player.inventory[e].selected=!1),e=b,a.player.inventory[b].selected=!0},d.addClickListeners(function(b){if(0===a.player.inventory.length)f("You do not have inventory!");else if(null===e)f("You did not select a key logger.");else{var g=e;Math.random()<.7&&null!==g?d.putKeylogger(b.latLng,function(b,d){c.infect(d,g,b),a.player=c.getPlayer()}):f("Keylogger deployment failed!!")}})}]),angular.module("honeypotApp").controller("TutorialCtrl",function(){});